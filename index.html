<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Slidegen - 优雅的演示文稿创作工具</title>
		<link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
		<style>
			:root {
				--primary-color: #3B82F6;
				--surface-color: #1E293B;
				--background-color: #0F172A;
				--text-primary: #F8FAFC;
				--text-secondary: #CBD5E1;
				--accent-color: #10B981;
				--error-color: #EF4444;
				--shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
				--shadow-md: 0 4px 6px rgba(0,0,0,0.1);
				--radius-md: 0.75rem;
			}

			body {
				margin: 0;
				padding: 0;
				font-family: 'Microsoft YaHei', system-ui, sans-serif;
				background: var(--background-color);
				color: var(--text-primary);
				min-height: 100vh;
				line-height: 1.5;
			}

			.header {
				padding: 1.25rem 2.5rem;
				display: flex;
				align-items: center;
				justify-content: space-between;
				background: var(--surface-color);
				box-shadow: var(--shadow-md);
				position: sticky;
				top: 0;
				z-index: 100;
			}

			.logo {
				display: flex;
				align-items: center;
				gap: 0.75rem;
				color: var(--text-primary);
				text-decoration: none;
				font-size: 1.5rem;
				font-weight: 600;
				transition: transform 0.2s ease;
			}

			.logo:hover {
				transform: translateY(-1px);
			}

			.main-content {
				max-width: 1200px;
				margin: 2rem auto;
				padding: 0 2rem;
				display: grid;
				gap: 2rem;
			}

			.upload-section {
				max-width: 800px;
				margin: 3rem auto;
				padding: 0 1.5rem;
			}

			.upload-area {
				border: 2px dashed var(--primary-color);
				border-radius: var(--radius-md);
				padding: 3rem 2rem;
				text-align: center;
				cursor: pointer;
				transition: all 0.3s ease;
				background: var(--surface-color);
			}

			.upload-area:hover {
				border-color: var(--accent-color);
				transform: translateY(-2px);
				box-shadow: var(--shadow-md);
			}

			.upload-icon {
				font-size: 3rem;
				color: var(--primary-color);
				margin-bottom: 1rem;
			}

			.file-list {
				max-width: 800px;
				margin: 2rem auto;
				padding: 0 1.5rem;
			}

			.file-item {
				background: var(--surface-color);
				border-radius: var(--radius-md);
				padding: 1rem 1.5rem;
				margin-bottom: 1rem;
				display: flex;
				align-items: center;
				justify-content: space-between;
				transition: all 0.3s ease;
			}

			.file-item:hover {
				transform: translateY(-2px);
				box-shadow: var(--shadow-md);
			}

			.file-name {
				display: flex;
				align-items: center;
				gap: 0.75rem;
				color: var(--text-primary);
			}

			.file-name i {
				color: var(--primary-color);
			}

			.file-actions {
				display: flex;
				gap: 0.75rem;
			}

			.btn {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				padding: 0.5rem 1rem;
				border-radius: var(--radius-md);
				border: none;
				font-size: 0.875rem;
				font-weight: 500;
				cursor: pointer;
				transition: all 0.2s ease;
			}

			.btn-preview {
				background: var(--primary-color);
				color: white;
			}

			.btn-preview:hover {
				background: color-mix(in srgb, var(--primary-color) 90%, black);
			}

			.btn-delete {
				background: var(--error-color);
				color: white;
			}

			.btn-delete:hover {
				background: color-mix(in srgb, var(--error-color) 90%, black);
			}

			.description {
				color: var(--text-secondary);
				margin: 0.5rem 0;
				font-size: 0.875rem;
			}

			@keyframes fadeIn {
				from { opacity: 0; transform: translateY(10px); }
				to { opacity: 1; transform: translateY(0); }
			}

			@keyframes fadeOut {
				from { opacity: 1; transform: translateY(0); }
				to { opacity: 0; transform: translateY(10px); }
			}

			@media (max-width: 640px) {
				.header {
					padding: 1rem;
					flex-direction: column;
					gap: 0.5rem;
				}

				.file-item {
					flex-direction: column;
					gap: 1rem;
				}

				.file-actions {
					width: 100%;
					justify-content: stretch;
				}

				.btn {
					flex: 1;
					justify-content: center;
				}
			}
		</style>
	</head>
	<body>
		<header class="header">
			<a href="#" class="logo">
				<i class="mdi mdi-presentation-play"></i>
				<span>Slidegen</span>
			</a>
			<p class="description">使用 Markdown，创建精美的演示文稿</p>
		</header>

		<main class="main-content">
			<div class="upload-section">
				<div class="upload-area" id="drop-zone" onclick="document.getElementById('file-input').click()">
					<i class="mdi mdi-cloud-upload upload-icon"></i>
					<h2>点击或拖放上传</h2>
					<p class="description">支持 Markdown 文件</p>
					<input type="file" id="file-input" hidden accept=".md,.markdown">
				</div>
			</div>

			<div class="file-list" id="file-list">
				<!-- 文件列表将通过 JavaScript 动态生成 -->
			</div>
		</main>

		<script type="module">
			import { previewPresentation } from './js/preview.js';
			window.previewPresentation = previewPresentation;

			// 创建日志容器
			const logContainer = document.createElement('div');
			logContainer.id = 'log-container';
			logContainer.style.cssText = `
				position: fixed;
				bottom: 20px;
				right: 20px;
				max-width: 400px;
				z-index: 9999;
			`;
			document.body.appendChild(logContainer);

			// 日志函数
			function log(message, type = 'info') {
				console.log(`[${new Date().toLocaleTimeString()}] ${message}`);
				const logEntry = document.createElement('div');
				logEntry.className = `log-entry ${type}`;
				logEntry.style.cssText = `
					padding: 10px;
					margin: 5px;
					border-radius: 4px;
					background: ${type === 'error' ? '#FEE2E2' : type === 'success' ? '#D1FAE5' : '#E0E7FF'};
					color: ${type === 'error' ? '#DC2626' : type === 'success' ? '#059669' : '#4F46E5'};
					box-shadow: 0 2px 4px rgba(0,0,0,0.1);
					animation: fadeIn 0.3s ease;
				`;
				logEntry.textContent = message;
				logContainer.appendChild(logEntry);

				// 3秒后自动移除
				setTimeout(() => {
					logEntry.style.animation = 'fadeOut 0.3s ease';
					setTimeout(() => logEntry.remove(), 300);
				}, 3000);
			}

			// 文件处理函数
			function handleFiles(files) {
				log(`开始处理 ${files.length} 个文件`);
				Array.from(files).forEach(file => {
					log(`处理文件: ${file.name} (${formatFileSize(file.size)})`);
					
					if (file.name.endsWith('.md') || file.type === 'text/markdown') {
						const reader = new FileReader();
						
						reader.onloadstart = () => {
							log(`开始读取文件: ${file.name}`);
						};

						reader.onprogress = (event) => {
							if (event.lengthComputable) {
								const percent = Math.round((event.loaded / event.total) * 100);
								log(`读取进度: ${percent}%`);
							}
						};

						reader.onload = (e) => {
							log(`文件读取完成: ${file.name}`, 'success');
							try {
								// 保存文件到本地存储
								const files = JSON.parse(localStorage.getItem('markdown-files') || '{}');
								files[file.name] = {
									content: e.target.result,
									timestamp: new Date().toISOString()
								};
								localStorage.setItem('markdown-files', JSON.stringify(files));
								log(`文件保存成功: ${file.name}`, 'success');
								
								// 更新文件列表显示
								updateFileList();
							} catch (error) {
								log(`保存文件失败: ${error.message}`, 'error');
								console.error('保存文件错误:', error);
							}
						};

						reader.onerror = () => {
							log(`文件读取失败: ${file.name}`, 'error');
							console.error('文件读取错误:', reader.error);
						};

						reader.readAsText(file);
					} else {
						log(`不支持的文件类型: ${file.name}`, 'error');
					}
				});
			}

			// 更新文件列表显示
			function updateFileList() {
				log('开始更新文件列表');
				const fileList = document.getElementById('file-list');
				const files = JSON.parse(localStorage.getItem('markdown-files') || '{}');
				
				// 清空当前列表
				fileList.innerHTML = '';
				
				// 添加文件项
				Object.entries(files).forEach(([filename, data]) => {
					log(`添加文件到列表: ${filename}`);
					const fileItem = document.createElement('div');
					fileItem.className = 'file-item';
					fileItem.innerHTML = `
						<div class="file-name">
							<i class="mdi mdi-file-document-outline"></i>
							<span>${filename}</span>
						</div>
						<div class="file-actions">
							<button class="btn btn-preview" onclick="previewFile('${filename}')">
								<i class="mdi mdi-eye"></i>
								预览
							</button>
							<button class="btn btn-delete" onclick="deleteFile('${filename}')">
								<i class="mdi mdi-delete"></i>
								删除
							</button>
						</div>
					`;
					fileList.appendChild(fileItem);
				});
				log(`文件列表更新完成，共 ${Object.keys(files).length} 个文件`);
			}

			// 预览文件
			window.previewFile = function(filename) {
				log(`准备预览文件: ${filename}`);
				try {
					const files = JSON.parse(localStorage.getItem('markdown-files') || '{}');
					const fileData = files[filename];
					if (fileData) {
						log(`开始预览: ${filename}`);
						window.previewPresentation(filename, fileData.content);
					} else {
						log(`文件不存在: ${filename}`, 'error');
					}
				} catch (error) {
					log(`预览失败: ${error.message}`, 'error');
					console.error('预览错误:', error);
				}
			};

			// 删除文件
			window.deleteFile = function(filename) {
				log(`准备删除文件: ${filename}`);
				if (confirm(`确定要删除 ${filename} 吗？`)) {
					try {
						const files = JSON.parse(localStorage.getItem('markdown-files') || '{}');
						delete files[filename];
						localStorage.setItem('markdown-files', JSON.stringify(files));
						log(`文件已删除: ${filename}`, 'success');
						updateFileList();
					} catch (error) {
						log(`删除失败: ${error.message}`, 'error');
						console.error('删除错误:', error);
					}
				} else {
					log(`取消删除: ${filename}`);
				}
			};

			// 工具函数：格式化文件大小
			function formatFileSize(bytes) {
				if (bytes === 0) return '0 B';
				const k = 1024;
				const sizes = ['B', 'KB', 'MB', 'GB'];
				const i = Math.floor(Math.log(bytes) / Math.log(k));
				return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
			}

			// 拖放处理
			const dropZone = document.getElementById('drop-zone');
			const fileInput = document.getElementById('file-input');

			dropZone.addEventListener('dragenter', (e) => {
				e.preventDefault();
				log('文件拖入上传区域');
				dropZone.classList.add('drag-over');
			});

			dropZone.addEventListener('dragover', (e) => {
				e.preventDefault();
				dropZone.classList.add('drag-over');
			});

			dropZone.addEventListener('dragleave', (e) => {
				e.preventDefault();
				log('文件离开上传区域');
				dropZone.classList.remove('drag-over');
			});

			dropZone.addEventListener('drop', (e) => {
				e.preventDefault();
				log('文件已放置到上传区域');
				dropZone.classList.remove('drag-over');
				handleFiles(e.dataTransfer.files);
			});

			fileInput.addEventListener('change', (e) => {
				log('通过点击选择文件');
				handleFiles(e.target.files);
				fileInput.value = '';
			});

			// 初始化
			log('页面初始化');
			updateFileList();
		</script>
	</body>
</html>
